<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
		<script src="js/mail-generator.js"></script>
		<link href="css/style.css" rel="stylesheet" media="screen">
		<title>Gee-Mail Challenge</title>
    <script>

 	window.onload = function (){

 		//sequential for loop to iterate through array items in order

		for (var i=0; i < sender.length; i++) {

			//anonymous function provides closure for jQuery event handlers to execute inside for loop

			(function () {

				//table for arrays' data

				var table = document.getElementById("table");
				var row = table.insertRow(0);
				var secondRow = table.insertRow(1);

				var cell1 = row.insertCell(0);
				var cell2 = row.insertCell(1);
				var cell3 = row.insertCell(2);

				var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

				var d = new Date();
				var monthName = months[d.getMonth()];
				var day = d.getDate();
				var year = d.getFullYear();
				var date = monthName + " " + day + "," + " " + year;

				//populates the rows and cells

				cell1.innerHTML = sender[i];
				cell2.innerHTML = subject[i];
				cell3.innerHTML = date;
				secondRow.innerHTML = body[i];

				//jquery effects to intially hide message's body until clicked, then user can click either row to hide again

				$(secondRow).hide();
				$(row).click(function(){
						$(secondRow).fadeToggle();
					});
				$(secondRow).click(function(){
					$(this).fadeOut();
				});

				//this variable stores the number of total messages

				var count = $('tr').length/2;

				//concatenation is inserted into HTML element to visually display animated counter
			
				$('a').html('Inbox' + ' ' + '(' + count + ')');

			//without proper closure, the loop would be finished before jQuery effects execute, and the index would only be recognized for the beginning row

			})(i);

		}

		setInterval(function getNewMessage(){

			//must redefine variables inside existing new function

			var table = document.getElementById("table");
			var row = table.insertRow(0);
			var secondRow = table.insertRow(1);

			var cell1 = row.insertCell(0);
			var cell2 = row.insertCell(1);
			var cell3 = row.insertCell(2);

			var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

			var d = new Date();
			var monthName = months[d.getMonth()];
			var day = d.getDate();
			var year = d.getFullYear();
			var date = monthName + " " + day + "," + " " + year;

			//if conditional statement inserts array element one by one and resets index to "0" after reaching end. Messages generate from top

	        if (i == sender.length) i = 0; cell1.insertAdjacentHTML('afterBegin', sender[i++]);
			if (i == subject.length) i = 0; cell2.insertAdjacentHTML('afterBegin', subject[i++]);
			cell3.insertAdjacentHTML('afterbegin', date);
			if (i == body.length) i = 0; secondRow.insertAdjacentHTML('afterBegin', body[i++]);

			//jQuery initially hides secondRow, but it appears/disappears when either row is clicked

			$(secondRow).hide();
			$(row).click(function(){
				$(secondRow).fadeToggle();
			});
			$(secondRow).click(function(){
				$(this).fadeOut();
			});

			//the message counter must be placed inside both functions to calculate all messages in the inbox

			var count = $('tr').length/2;
		
			$('a').html('Inbox' + ' ' + '(' + count + ')');

		//new message appears every 5 seconds

		}, 5000);
	};
   
    </script>
	</head>
	<body>
		<header>
			<h1>Gee-Mail</h1>
		</header>
		<div id="side">
			<ul>
				<li><a href="#inbox" title="Inbox"></a>
			    </li>
			</ul>
		</div>

		<div class="container" id="main">
			<table id="table"></table>
		</div>
	</body>
</html>